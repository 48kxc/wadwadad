<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Local WebLLM Toolkit</title>
  <script type="module">
    import * as webllm from "https://esm.run/@mlc-ai/web-llm";

    let engine = null;

    async function loadModel() {
      document.getElementById("status").textContent = "Loading model...";
      engine = await webllm.CreateMLCEngine("Qwen2.5-0.5B-Instruct-q4f16_1-MLC");
      document.getElementById("status").textContent = "Model loaded.";
    }

    async function run(prompt) {
      if (!engine) return "Model not loaded!";
      const reply = await engine.chat.completions.create({
        messages: [{ role: "user", content: prompt }],
        max_tokens: 300,
      });
      return reply.choices[0].message.content;
    }

    // CHAT SECTION
    async function sendChat() {
      const input = document.getElementById("chatInput").value;
      const log = document.getElementById("chatLog");

      if (!input.trim()) return;

      log.value += "You: " + input + "\n\n";

      const response = await run(input);

      log.value += "AI: " + response + "\n\n";
      log.scrollTop = log.scrollHeight;
      document.getElementById("chatInput").value = "";
    }

    // ESSAY
    async function writeEssay() {
      const topic = document.getElementById("essayTopic").value;
      document.getElementById("essayOutput").value = "Thinking...";
      const response = await run(`Write a full essay about: ${topic}`);
      document.getElementById("essayOutput").value = response;
    }

    // PARAGRAPH
    async function writeParagraph() {
      const topic = document.getElementById("paraTopic").value;
      document.getElementById("paraOutput").value = "Thinking...";
      const response = await run(`Write one detailed paragraph about: ${topic}`);
      document.getElementById("paraOutput").value = response;
    }

    // SHORT ANSWER
    async function shortAnswer() {
      const q = document.getElementById("shortQ").value;
      document.getElementById("shortOutput").value = "Thinking...";
      const response = await run(`Answer briefly: ${q}`);
      document.getElementById("shortOutput").value = response;
    }

    window.loadModel = loadModel;
    window.sendChat = sendChat;
    window.writeEssay = writeEssay;
    window.writeParagraph = writeParagraph;
    window.shortAnswer = shortAnswer;
  </script>

  <style>
    body { font-family: Arial; background: #111; color: #eee; padding: 20px; }
    textarea, input { width: 100%; background: #222; color: #fff; border: 1px solid #444; padding: 10px; border-radius: 6px; }
    button { padding: 10px 20px; background: #333; border: none; color: #fff; border-radius: 6px; cursor: pointer; }
    button:hover { background: #555; }
    .card { background: #1a1a1a; padding: 20px; border-radius: 10px; margin-top: 20px; }
    h2 { margin-top: 0; }
  </style>
</head>
<body>

<h1>WebLLM Toolbox</h1>
<button onclick="loadModel()">Load Model</button>
<div id="status" style="margin-top:10px;color:#0f0;"></div>

<!-- CHAT AREA -->
<div class="card">
  <h2>Chat</h2>
  <textarea id="chatLog" rows="10" readonly></textarea><br><br>
  <input id="chatInput" placeholder="Type a message...">
  <button onclick="sendChat()">Send</button>
</div>

<!-- ESSAY WRITER -->
<div class="card">
  <h2>Essay Writer</h2>
  <input id="essayTopic" placeholder="Enter essay topic...">
  <button onclick="writeEssay()">Generate Essay</button>
  <textarea id="essayOutput" rows="6"></textarea>
</div>

<!-- PARAGRAPH WRITER -->
<div class="card">
  <h2>Paragraph Writer</h2>
  <input id="paraTopic" placeholder="Enter paragraph topic...">
  <button onclick="writeParagraph()">Generate Paragraph</button>
  <textarea id="paraOutput" rows="4"></textarea>
</div>

<!-- SHORT QUESTION ANSWER -->
<div class="card">
  <h2>Short Answer</h2>
  <input id="shortQ" placeholder="Ask a short question...">
  <button onclick="shortAnswer()">Answer</button>
  <textarea id="shortOutput" rows="2"></textarea>
</div>

</body>
</html>
